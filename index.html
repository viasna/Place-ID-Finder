<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google Maps Place ID Finder (Multi)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg:#f8fafc; --card:#ffffff; --text:#0f172a; --muted:#64748b; --primary:#2563eb; --border:#e2e8f0;
}
[data-theme="dark"] {
  --bg:#0f172a; --card:#020617; --text:#f8fafc; --muted:#94a3b8; --border:#1e293b;
}
* { box-sizing:border-box; font-family:system-ui,-apple-system,Segoe UI,Roboto; }
body { background:var(--bg); color:var(--text); display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px; }
.card { background:var(--card); max-width:700px; width:100%; padding:28px; border-radius:16px; box-shadow:0 20px 40px rgba(0,0,0,.15); }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
h1 { margin:0; font-size:22px; }
p { color:var(--muted); font-size:14px; margin:8px 0 20px; }
textarea { width:100%; padding:14px; font-size:15px; border-radius:12px; border:1px solid var(--border); background:transparent; color:var(--text); resize:vertical; min-height:100px; }
button { padding:12px 14px; border:none; border-radius:10px; background:var(--primary); color:white; font-size:14px; cursor:pointer; margin-top:10px; }
.actions { display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
.results { margin-top:20px; }
.place { display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,.03); padding:10px 12px; border-radius:10px; margin-top:8px; font-family:monospace; word-break:break-all; }
.place button { background:#0f172a; font-size:12px; padding:6px 10px; }
footer { margin-top:18px; font-size:12px; color:var(--muted); text-align:center; }
.warning { color:#b91c1c; font-size:13px; margin-top:5px; }
</style>
</head>

<body data-theme="light">
<div class="card">

<header>
  <h1>Place ID Finder</h1>
  <button onclick="toggleTheme()">ðŸŒ—</button>
</header>

<p>Paste one or multiple Google Maps URLs (long or short). One per line.</p>

<textarea id="urls" placeholder="Paste URLs here, one per line"></textarea>
<button style="width:100%" onclick="process()">Get Place ID(s)</button>

<div class="actions" id="bulkActions" style="display:none">
  <button onclick="copyAll()">Copy All</button>
  <button onclick="exportCSV()">Export CSV</button>
</div>

<div id="results" class="results"></div>
<footer>Works offline â€¢ No API â€¢ No tracking</footer>
</div>

<script>
function toggleTheme() {
  document.body.dataset.theme = document.body.dataset.theme === "dark" ? "light" : "dark";
}

function cidToPlaceId(cid) {
  const [a,b] = cid.split(":");
  let n = (BigInt(a) << 64n) | BigInt(b);
  let bytes = [];
  while (n > 0n) { bytes.unshift(Number(n & 255n)); n >>= 8n; }
  return "ChIJ" + btoa(String.fromCharCode(...bytes)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
}

function process() {
  const urlsText = document.getElementById("urls").value.trim();
  const out = document.getElementById("results");
  out.innerHTML = "";
  document.getElementById("bulkActions").style.display = "none";

  if (!urlsText) return out.textContent = "Please paste at least one URL.";

  const lines = urlsText.split(/\r?\n/);
  const allFound = [];

  lines.forEach((url, index) => {
    url = url.trim();
    if (!url) return;

    const found = new Set();

    // Detect short URLs and warn
    if (url.includes('maps.app.goo.gl') || url.includes('goo.gl/maps')) {
      found.add(`[Line ${index+1}] Short URL detected: please expand in browser`);
    }

    // Extract Place IDs
    (url.match(/ChI[a-zA-Z0-9_-]{20,}/g)||[]).forEach(p => found.add(p));
    (url.match(/0x[0-9a-f]+:0x[0-9a-f]+/gi)||[]).forEach(cid => found.add(cidToPlaceId(cid)));

    if (found.size > 0) {
      found.forEach(id => allFound.push({line:index+1, id}));
    }
  });

  if (!allFound.length) return out.textContent = "No Place IDs found.";

  document.getElementById("bulkActions").style.display = "flex";

  allFound.forEach(entry => {
    out.innerHTML += `<div class="place"><span>${entry.id}</span><button onclick="copyText('${entry.id}')">Copy</button></div>`;
  });
}

function copyText(t) { navigator.clipboard.writeText(t); }
function copyAll() {
  const ids = [...document.querySelectorAll(".place span")].map(e => e.textContent).join("\n");
  navigator.clipboard.writeText(ids);
}
function exportCSV() {
  const ids = [...document.querySelectorAll(".place span")].map(e => `"${e.textContent}"`).join("\n");
  const blob = new Blob(["place_id\n"+ids], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "place_ids.csv";
  a.click();
}
</script>

</body>
</html>
